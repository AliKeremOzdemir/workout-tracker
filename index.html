<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hardened Tracker</title><link rel="manifest" href="manifest.json"><meta name="theme-color" content="#4CAF50"><style>body{font-family:Arial;margin:16px}textarea,input,button{width:100%;padding:10px;margin-top:6px}textarea{min-height:110px}.row{display:grid;grid-template-columns:1fr 1fr;gap:8px}@media(max-width:560px){.row{grid-template-columns:1fr}}#status{margin-top:8px;font-size:12px;color:#455a64}#status[data-type=ok]{color:#2e7d32}#status[data-type=warn]{color:#e65100}.banner{position:fixed;left:0;right:0;bottom:0;background:#263238;color:#fff;padding:10px 16px;display:none}.banner.show{display:block}.banner button{background:#4CAF50;color:#fff;border:none;padding:8px 12px}</style></head><body><h1>Workout & Meal Tracker</h1><div class="section"><label for="workout">Workout Notes</label><textarea id="workout"></textarea></div><div class="section"><label for="meal">Meal Notes</label><textarea id="meal"></textarea></div><div class="section"><label for="progress">Progress Notes</label><textarea id="progress"></textarea></div><div class="row"><button id="saveBtn" type="button">Save (Offline)</button><button id="clearBtn" type="button">Clear</button></div><div class="row"><button id="exportBtn" type="button">Export JSON</button><label style="display:block"><input type="file" id="importFile" accept="application/json"/> Import JSON</label></div><div id="status" role="status" aria-live="polite"></div><div id="updateBanner" class="banner">Update available. <button id="reloadBtn">Reload</button></div><script>function storageAvailable(t="localStorage"){try{var e=window[t],a="__test__";return e.setItem(a,a),e.removeItem(a),!0}catch(t){return!1}}const safeStore={available:storageAvailable("localStorage"),get:function(t,e=""){if(!this.available)return e;try{return localStorage.getItem(t)??e}catch(t){return console.warn("get failed",t),e}},set:function(t,e){if(!this.available)return!1;try{return localStorage.setItem(t,e),!0}catch(t){return t&&("QuotaExceededError"===t.name||22===t.code)?alert("Local storage is full. Please export and clear some data."):console.warn("set failed",t),!1}},remove:function(t){if(this.available)try{localStorage.removeItem(t)}catch(t){console.warn("remove failed",t)}}};function debounce(t,e=500){let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>t.apply(null,n),e)}}function setStatus(t,e="info"){const a=document.getElementById("status");a.textContent=t,a.dataset.type=e}function loadData(){document.getElementById("workout").value=safeStore.get("workout",""),document.getElementById("meal").value=safeStore.get("meal",""),document.getElementById("progress").value=safeStore.get("progress",""),setStatus(safeStore.get("lastUpdated","")?"Last update: "+new Date(safeStore.get("lastUpdated","")).toLocaleString():"Ready")}const doSave=debounce(()=>{const t={workout:document.getElementById("workout").value,meal:document.getElementById("meal").value,progress:document.getElementById("progress").value,lastUpdated:new Date().toISOString()};let e=!0;for(const[a,n]of Object.entries(t))safeStore.set(a,n)||(e=!1);setStatus(e?"Saved "+new Date().toLocaleTimeString():"Save failed",e?"ok":"warn")},500);function saveDataManual(){doSave()}function clearData(){confirm("Clear all local data?")&&(["workout","meal","progress","lastUpdated"].forEach((t=>safeStore.remove(t))),loadData(),setStatus("Cleared","warn"))}const MAX_IMPORT_BYTES=1048576;function exportData(){const t={workout:safeStore.get("workout",""),meal:safeStore.get("meal",""),progress:safeStore.get("progress",""),lastUpdated:safeStore.get("lastUpdated",new Date().toISOString()),version:2},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e);const n=new Date().toISOString().slice(0,19).replace(/[:T]/g,"-");a.download=`fitness-tracker-backup-${n}.json`,document.body.appendChild(a),a.click(),a.remove()}function importData(t){if(!t)return alert("Select a JSON file."),void 0;if(t.size>MAX_IMPORT_BYTES)return alert("File too large (1MB limit)."),void 0;const e=new FileReader;e.onerror=()=>alert("Read error"),e.onload=a=>{try{const n=JSON.parse(a.target.result);if("object"!=typeof n||null===n)throw new Error("Invalid JSON");if("workout"in n&&"string"!=typeof n.workout)throw new Error("workout must be string");if("meal"in n&&"string"!=typeof n.meal)throw new Error("meal must be string");if("progress"in n&&"string"!=typeof n.progress)throw new Error("progress must be string");if("lastUpdated"in n&&isNaN(Date.parse(n.lastUpdated)))throw new Error("invalid lastUpdated");safeStore.set("workout",null!=n.workout?n.workout:""),safeStore.set("meal",null!=n.meal?n.meal:""),safeStore.set("progress",null!=n.progress?n.progress:""),safeStore.set("lastUpdated",n.lastUpdated||new Date().toISOString()),loadData(),setStatus("Imported","ok")}catch(t){alert("Import error: "+t.message)}} ,e.readAsText(t,"utf-8")}window.addEventListener("load",(()=>{loadData(),document.getElementById("saveBtn").addEventListener("click",saveDataManual),document.getElementById("clearBtn").addEventListener("click",clearData),document.getElementById("exportBtn").addEventListener("click",exportData),document.getElementById("importFile").addEventListener("change",(t=>importData(t.target.files&&t.target.files[0]))),["workout","meal","progress"].forEach((t=>document.getElementById(t).addEventListener("input",doSave))),window.addEventListener("online",(()=>setStatus("Online","ok"))),window.addEventListener("offline",(()=>setStatus("Offline â€” working with last saved data","warn"))),"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js").then((t=>{t.waiting&&showUpdateBanner(t.waiting),t.addEventListener("updatefound",(()=>{const e=t.installing;e&&e.addEventListener("statechange",(()=>{"installed"===e.state&&navigator.serviceWorker.controller&&showUpdateBanner(e)}))})),navigator.serviceWorker.addEventListener("controllerchange",(()=>window.location.reload()))})).catch((t=>console.warn("SW register fail",t)))}));function showUpdateBanner(t){const e=document.getElementById("updateBanner");e.classList.add("show"),document.getElementById("reloadBtn").onclick=(()=>{t.postMessage({type:"SKIP_WAITING"})})}</script></body></html>